<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
											
<mapper namespace="com.project.gwasil_zero.mapper.AdminMapper">
	<select id="selectNewMemList" parameterType="hashmap" resultType="com.project.gwasil_zero.model.User">
		SELECT *
		FROM (
			SELECT *
			FROM TBL_USER
			ORDER BY CDATE DESC
		)
		WHERE ROWNUM &lt;= 5
	</select>	
	
	<select id="selectLawPassList" parameterType="hashmap" resultType="com.project.gwasil_zero.model.Lawyer">
		SELECT *
		FROM LAWYER
		WHERE LAWYER_PASS = 'N' AND ROWNUM &lt;= 5
	</select>
	
	<select id="selectReportList" parameterType="hashmap" resultType="com.project.gwasil_zero.model.Report">
		SELECT *
		FROM (
		    SELECT *
		    FROM REPORT
		    WHERE REPORT_STATUS != 'DELETE'
		    ORDER BY CDATE DESC
		)
		WHERE ROWNUM &lt;= 5
	</select>	
	
	<select id="selectUserList" parameterType="hashmap" resultType="com.project.gwasil_zero.model.User">
		SELECT *
		FROM TBL_USER U
		WHERE 1=1
		<if test="status != null and status != '' and status != 'ALL'">
			<choose>
				<when test="status == 'out'">
					AND U.USER_STATUS = 'Out'
				</when>
				<when test="status == 'paid'">
					AND U.USER_STATUS = 'Nomal'
					AND EXISTS (
						SELECT 1 FROM PAY P WHERE P.USER_ID = U.USER_ID
					)
				</when>
				<when test="status == 'free'">
					AND U.USER_STATUS = 'Nomal'
					AND NOT EXISTS (
						SELECT 1 FROM PAY P WHERE P.USER_ID = U.USER_ID
					)
				</when>
			</choose>
		</if>
	
		<if test="key != null and key != '' and word != null and word != ''">
			<choose>
				<when test="key == 'userName'">
					AND U.USER_NAME LIKE '%' || #{word} || '%'
				</when>
				<when test="key == 'packageName'">
					AND EXISTS (
						SELECT 1 FROM PAY P WHERE P.USER_ID = U.USER_ID AND P.PACKAGE_NAME LIKE '%' || #{word} || '%'
					)
				</when>
			</choose>
		</if>
	
		ORDER BY CDATE DESC
		OFFSET #{page} ROWS FETCH NEXT #{pageSize} ROWS ONLY
	</select>
	
	<select id="userCnt" parameterType="hashmap" resultType="int">
		SELECT COUNT(*)
		FROM TBL_USER U
		WHERE 1=1
		<if test="status != null and status != '' and status != 'ALL'">
			<choose>
				<when test="status == 'out'">
					AND U.USER_STATUS = 'Out'
				</when>
				<when test="status == 'paid'">
					AND U.USER_STATUS = 'Nomal'
					AND EXISTS (
						SELECT 1 FROM PAY P WHERE P.USER_ID = U.USER_ID
					)
				</when>
				<when test="status == 'free'">
					AND U.USER_STATUS = 'Nomal'
					AND NOT EXISTS (
						SELECT 1 FROM PAY P WHERE P.USER_ID = U.USER_ID
					)
				</when>
			</choose>
		</if>
	
		<if test="key != null and key != '' and word != null and word != ''">
			<choose>
				<when test="key == 'userName'">
					AND U.USER_NAME LIKE '%' || #{word} || '%'
				</when>
				<when test="key == 'packageName'">
					AND EXISTS (
						SELECT 1 FROM PAY P WHERE P.USER_ID = U.USER_ID AND P.PACKAGE_NAME LIKE '%' || #{word} || '%'
					)
				</when>
			</choose>
		</if>
		
	</select>
	
</mapper>