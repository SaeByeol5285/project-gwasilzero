<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.project.gwasil_zero.mapper.BoardMapper">
	<select id="selectBoardList" parameterType="hashmap" resultType="com.project.gwasil_zero.model.Board">
		SELECT *
      	FROM BOARD B
      	INNER JOIN TBL_USER M ON B.USER_ID = M.USER_ID  
      	WHERE 1=1
      	<if test="searchOption != null and searchOption == 'all'">
        	 AND (BOARD_TITLE LIKE '%' || #{keyword} || '%' 
             	  OR USER_NAME LIKE '%' || #{keyword} || '%') 
      	</if>
      	<if test="searchOption != null and searchOption == 'title'">
        	 AND BOARD_TITLE LIKE '%' || #{keyword} || '%'
     	 </if>
     	 <if test="searchOption != null and searchOption == 'name'">
     	    AND USER_NAME LIKE '%' || #{keyword} || '%' 
     	 </if>
     	 order by b.cdate desc
     	 OFFSET #{page} rows fetch next #{pageSize} rows only
	</select>
	
	<select id="selectBoardCnt" parameterType="hashmap" resultType="int">
      SELECT count(*)
      FROM BOARD B
      INNER JOIN TBL_USER M ON B.USER_ID = M.USER_ID 
      WHERE 1=1
      <if test="searchOption != null and searchOption == 'all'">
         AND (BOARD_TITLE LIKE '%' || #{keyword} || '%' 
               OR USER_NAME LIKE '%' || #{keyword} || '%') 
      </if>
      <if test="searchOption != null and searchOption == 'title'">
         AND BOARD_TITLE LIKE '%' || #{keyword} || '%'
      </if>
      <if test="searchOption != null and searchOption == 'name'">
         AND USER_NAME LIKE '%' || #{keyword} || '%' 
      </if>
   </select>


	<insert id = "insertBoard" parameterType="hashmap"  useGeneratedKeys="true" keyColumn="board_no" keyProperty="boardNo">
		insert into board (board_no, board_title, contents, user_id, cnt, cdate, udate, board_status, lawyer_id, lawyer_review) 
		values
		(board_seq.nextval, #{title}, #{contents}, #{userId}, 0, SYSDATE, SYSDATE, #{boardStatus}, null, null)
	</insert>
	
	<insert id="insertBoardFile" parameterType="hashmap">
    	insert into board_file values (
  	      #{boardNo},
   	      #{filePath, jdbcType=VARCHAR},
       	 #{fileName, jdbcType=VARCHAR},
     	   #{thumbnail, jdbcType=VARCHAR},
   	     #{fileRealName, jdbcType=VARCHAR}
    	)
	</insert>
</mapper>