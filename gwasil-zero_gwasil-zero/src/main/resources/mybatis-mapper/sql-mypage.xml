<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.gwasil_zero.mapper.MypageMapper">
	<select id="selectUser" parameterType="hashmap" resultType="com.project.gwasil_zero.model.User">
	    SELECT USER_NAME, USER_PHONE, USER_EMAIL
	    FROM TBL_USER
	    WHERE USER_ID = #{userId}
	</select>
	<delete id="deleteUser" parameterType="hashmap">
	    DELETE FROM TBL_USER
	    WHERE USER_ID = #{userId}
	</delete>
	
	<select id="selectUserBoardList" parameterType="hashmap" resultType="hashmap">
	    SELECT
	        B.BOARD_NO AS boardNo,
	        B.BOARD_TITLE AS boardTitle,
	        B.CONTENTS AS contents,
	        F.FILE_PATH || '/' || F.FILE_REALNAME AS thumb
	    FROM
	        BOARD B
	    LEFT JOIN BOARD_FILE F ON B.BOARD_NO = F.BOARD_NO AND F.THUMBNAIL = 'Y'
	    WHERE
	        B.USER_ID = #{userId}
	    ORDER BY B.CDATE DESC
	</select>
	
	<select id="selectUserChatList" parameterType="hashmap" resultType="com.project.gwasil_zero.model.Chat">
	    SELECT 
	        C.CHAT_NO            AS chatNo,
	        L.LAWYER_NAME        AS lawyerName,
	        M.MESSAGE            AS message,
	        TO_CHAR(M.TIME, 'YYYY-MM-DD HH24:MI') AS chatTime
	    FROM 
	        CHAT C
	    JOIN CHAT_MESSAGE M ON C.CHAT_NO = M.CHAT_NO
	    JOIN LAWYER L ON C.RECEIVER_ID = L.LAWYER_ID
	    WHERE 
	        C.SENDER_ID = #{userId}
	        AND M.TIME = (
	            SELECT MAX(TIME) FROM CHAT_MESSAGE WHERE CHAT_NO = C.CHAT_NO
	        )
	    ORDER BY M.TIME DESC
	</select>
	
	
	<select id="selectMyPayList" parameterType="hashmap" resultType="com.project.gwasil_zero.model.Pay">
	    SELECT *
	    FROM PAY
	   	WHERE USER_ID = #{userId}
	    
	</select>
	
	<select id="selectUserForMypage" parameterType="hashmap" resultType="com.project.gwasil_zero.model.User">
	    SELECT USER_NAME, USER_PHONE, USER_EMAIL, USER_ID
	    FROM TBL_USER
	    WHERE USER_ID = #{userId}
	</select>
	<update id="updateUserInfo" parameterType="hashmap">
	    UPDATE TBL_USER
	    SET
	        USER_NAME = #{userName},
	        USER_PHONE = #{userPhone},
	        USER_EMAIL = #{userEmail}
	    WHERE USER_ID = #{userId}
	</update>
	
	<select id="selectUserInfo" parameterType="hashmap" resultType="com.project.gwasil_zero.model.User">
	    SELECT USER_ID, USER_NAME, USER_PHONE, USER_EMAIL
	    FROM TBL_USER
	    WHERE USER_ID = #{sessionId}
	</select>
	
	<!-- 비밀번호 확인용 -->
	<select id="selectUserById" parameterType="hashmap" resultType="com.project.gwasil_zero.model.User">
	    SELECT *
	    FROM TBL_USER
	    WHERE USER_ID = #{userId}
	</select>

	<!-- 탈퇴 처리 (user_status 변경 or 삭제) -->
	<update id="deleteUserByAdmin" parameterType="hashmap">
	    UPDATE TBL_USER
	    SET USER_STATUS = 'OUT',
	        CDATE = SYSDATE
	    WHERE USER_ID = #{userId}
	</update>
	
</mapper>
