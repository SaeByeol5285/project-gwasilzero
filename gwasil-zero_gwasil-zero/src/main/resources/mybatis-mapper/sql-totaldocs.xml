<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.gwasil_zero.mapper.TotalDocsMapper">
	
	<!-- 공지사항/이용문의 공통 리스트 -->
	<select id="selectDocsList" parameterType="hashmap" resultType="com.project.gwasil_zero.model.TotalDocs"> 
		SELECT * FROM TOTALDOCS 
		WHERE KIND = #{kind} 
		<if test="searchOption != null and searchOption == 'all'">
			AND (TOTAL_TITLE LIKE '%' || #{keyword} || '%' OR USER_ID LIKE '%' || #{keyword} || '%')
		</if>
	
		<if test="searchOption != null and searchOption == 'title'">
			AND (TOTAL_TITLE LIKE '%' || #{keyword} || '%')
		</if>
	
		<if test="searchOption != null and searchOption == 'writer'">
			AND (USER_ID LIKE '%' || #{keyword} || '%')
		</if> 
		ORDER BY CDATE DESC 
		OFFSET #{page} ROWS FETCH NEXT #{pageSize} ROWS ONLY 
	</select>

	<!-- 공지사항/이용문의 공통 페이징 -->
	<select id="selectDocsCnt" parameterType="hashmap" resultType="int">
		SELECT COUNT(*) 
		FROM TOTALDOCS
		WHERE KIND = #{kind}
		<if test="searchOption != null and searchOption == 'all'">
			AND (TOTAL_TITLE LIKE '%' || #{keyword} || '%' OR USER_ID LIKE '%' || #{keyword} || '%')		
		</if>
		<if test="searchOption != null and searchOption == 'title'">
			AND (TOTAL_TITLE LIKE '%' || #{keyword} || '%')
		</if>
		<if test="searchOption != null and searchOption == 'writer'">
			AND (USER_ID LIKE '%' || #{keyword} || '%') 
		</if>
	</select>
	
	<!--상세보기-->
	<select id="selectDocsInfo" parameterType="hashmap" resultType="com.project.gwasil_zero.model.TotalDocs">
		SELECT *
		FROM TOTALDOCS
		WHERE TOTAL_NO = #{totalNo}
		<if test="kind != null and kind != ''">
			AND KIND = #{kind}
		</if>
	</select>
	
	<!--이미지리스트-->
	<select id = "selectImgList" parameterType="hashmap" resultType="com.project.gwasil_zero.model.TotalFile">
		SELECT *
		FROM TOTALDOCS D 
		INNER JOIN TOTAL_FILE F ON D.TOTAL_NO = F.TOTAL_NO
		WHERE D.TOTAL_NO = #{totalNo}
	</select>
	
	<!--이전 글-->
	<select id = "selectPrevDocs" parameterType="hashmap" resultType="com.project.gwasil_zero.model.TotalDocs">
		SELECT * 
		FROM TOTALDOCS
		WHERE TOTAL_NO &lt; #{totalNo}
		<if test="kind != null and kind != ''">
			AND KIND = #{kind}
		</if>
		ORDER BY TOTAL_NO DESC
		FETCH FIRST 1 ROWS ONLY
	</select>
	
	<!--다음 글-->
	<select id = "selectNextDocs" parameterType="hashmap" resultType="com.project.gwasil_zero.model.TotalDocs">
		SELECT * 
		FROM TOTALDOCS
		WHERE TOTAL_NO &gt; #{totalNo}
		<if test="kind != null and kind != ''">
			AND KIND = #{kind}
		</if>
		ORDER BY TOTAL_NO ASC
		FETCH FIRST 1 ROWS ONLY
	</select>
	




	
	<update id="updateCnt" parameterType="hashmap">
		UPDATE TOTALDOCS
		SET
			CNT = CNT+1
		WHERE TOTAL_NO = #{totalNo}
	</update>
	
	
	
	<insert id = "insertNotice"  parameterType="hashmap" useGeneratedKeys="true" keyColumn="TOTAL_NO" keyProperty="totalNo">
		INSERT INTO TOTALDOCS (TOTAL_NO, TOTAL_TITLE, TOTAL_CONTENTS, CDATE, UDATE, USER_ID, KIND, CNT)
		VALUES (TOTALDOCS_SEQ.NEXTVAL, #{totalTitle}, #{totalContents}, SYSDATE, SYSDATE, #{userId}, #{kind}, 0)
	</insert>
	
	<insert id="insertFiles" parameterType="hashmap">
		INSERT INTO TOTAL_FILE
		VALUES (#{totalNo},#{filePath},#{fileName})
	</insert>
	

	
	<delete id="deleteNotice" parameterType="hashmap">
		DELETE 
		FROM TOTALDOCS
		WHERE TOTAL_NO = #{totalNo}
	</delete>
	
	<update id="updateNotice" parameterType="map">
	    UPDATE TOTALDOCS
	    SET
	        TOTAL_TITLE = #{totalTitle},
	        TOTAL_CONTENTS = #{totalContents},
	        UDATE = SYSDATE
	    WHERE TOTAL_NO = #{totalNo}
	</update>
	
	<insert id="insertFile" parameterType="map">
	    INSERT INTO TOTAL_FILE (TOTAL_NO, FILE_NAME, FILE_PATH)
	    VALUES (#{totalNo}, #{fileName}, #{filePath})
	</insert>

</mapper>




